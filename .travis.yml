dist: xenial
language: ruby
cache: bundler

git:
  depth: 1

services:
  - docker

before_install:
  # Install Kubectl
  - curl -LO https://storage.googleapis.com/kubernetes-release/release/`curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt`/bin/linux/amd64/kubectl
  - chmod +x kubectl
  - sudo mv kubectl /usr/local/bin/kubectl

  # Install KinD
  - curl -sLo kind https://github.com/kubernetes-sigs/kind/releases/download/v0.7.0/kind-linux-amd64
  - chmod +x kind
  - sudo mv kind /usr/local/bin/kind

before_script:
  - mkdir -p $HOME/.kube
  - touch $HOME/.kube/config
  - export KUBECONFIG=$HOME/.kube/config
  - bin/setup-kind

rvm:
  - 2.4.9
env:
  - KUBERNETES_VERSION=1.11-latest PARALLEL=true
  - KUBERNETES_VERSION=1.12-latest PARALLEL=true
  - KUBERNETES_VERSION=1.13-latest PARALLEL=true
  - KUBERNETES_VERSION=1.14-latest PARALLEL=true
  - KUBERNETES_VERSION=1.15-latest PARALLEL=true
  - KUBERNETES_VERSION=1.16-latest PARALLEL=true

  - KUBERNETES_VERSION=1.11-latest PARALLEL=false
  - KUBERNETES_VERSION=1.12-latest PARALLEL=false
  - KUBERNETES_VERSION=1.13-latest PARALLEL=false
  - KUBERNETES_VERSION=1.14-latest PARALLEL=false
  - KUBERNETES_VERSION=1.15-latest PARALLEL=false
  - KUBERNETES_VERSION=1.16-latest PARALLEL=false

jobs:
  fast_finish: true

script:
  - CI=1 bin/test-ci

notifications:
  email: false
