containers:
  default:
    docker: circleci/ruby:2.6.6
  ruby30:
    docker: ruby:3.0
  ruby27:
    docker: ruby:2.7
  ruby26:
    docker: ruby:2.6.6

steps:
  - label: Lint
    timeout: 5m
    run:
      - bundle: ~
      - bundle exec rubocop

  - label: 'Run Test Suite (:kubernetes: 1.21-latest :ruby: 3.0)'
    run:
    - bundle: ~
    - bin/test
    container: ruby30
    kubernetes:
      version: "1.21.2"
    git:
      history: true

  - label: 'Run Test Suite (:kubernetes: 1.20-latest :ruby: 3.0)'
    run:
    - bundle: ~
    - bin/test
    container: ruby30
    kubernetes:
      version: "1.20.7"
    git:
      history: true

  - label: 'Run Test Suite (:kubernetes: 1.19-latest :ruby: 2.7)'
    run:
    - bundle: ~
    - bin/test
    container: ruby27
    kubernetes:
      version: "1.19.11"
    git:
      history: true

  - label: 'Run Test Suite (:kubernetes: 1.18-latest)'
    run:
    - bundle: ~
    - bin/test
    container: ruby26
    kubernetes:
      version: "1.18.19"
    git:
      history: true

  - label: 'Run Test Suite (:kubernetes: 1.17-latest)'
    run:
    - bundle: ~
    - bin/test
    container: ruby26
    kubernetes:
      version: "1.17.17"
    git:
      history: true
