containers:
  default:
    docker: circleci/ruby:2.5.7

steps:
  - label: Lint
    timeout: 5m
    run:
      - bundle: ~
      - bundle exec rubocop

  - label: 'Run Test Suite (:kubernetes: v1.18.4 :ruby: 2.7)'
    timeout: 10m
    run:
      - scripts/ci
    agents:
      queue: kind-ci
    env:
      RUBY_VERSION: "2.7"
      KIND_VERSION: v0.8.1
      KUBECTL_VERSION: v1.18.4
      KIND_CLUSTERS: |
        clusters:
          - name: krane
            k8s_version: v1.18.4

  - label: 'Run Test Suite (:kubernetes: v1.18.4)'
    timeout: 10m
    run:
      - scripts/ci
    agents:
      queue: kind-ci
    env:
      KIND_VERSION: v0.8.1
      KUBECTL_VERSION: v1.18.4
      KIND_CLUSTERS: |
        clusters:
          - name: krane
            k8s_version: v1.18.4

  - label: 'Run Test Suite (:kubernetes: v1.17.5)'
    timeout: 10m
    run:
      - scripts/ci
    agents:
      queue: kind-ci
    env:
      KIND_VERSION: v0.8.1
      KUBECTL_VERSION: v1.17.5
      KIND_CLUSTERS: |
        clusters:
          - name: krane
            k8s_version: v1.17.5

  - label: 'Run Test Suite (:kubernetes: v1.16.9)'
    timeout: 10m
    run:
      - scripts/ci
    agents:
      queue: kind-ci
    env:
      KIND_VERSION: v0.8.1
      KUBECTL_VERSION: v1.16.9
      KIND_CLUSTERS: |
        clusters:
          - name: krane
            k8s_version: v1.16.9

  - label: 'Run Test Suite (:kubernetes: v1.15.11)'
    timeout: 10m
    run:
      - scripts/ci
    agents:
      queue: kind-ci
    env:
      KIND_VERSION: v0.8.1
      KUBECTL_VERSION: v1.15.11
      KIND_CLUSTERS: |
        clusters:
          - name: krane
            k8s_version: v1.15.11
